{{define "findpwd"}}
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>千兆浏览器-找回密码</title>
    <link rel="stylesheet" href="/css/pwd/style.css">
</head>

<body>
    <div id="header">
        <p>
            <a href="#" class="logo">
                <img src="/img/logo_big.jpg" alt="">
            </a>
            <span>找回密码</span>
        </p>
    </div>
    <div id="main">
        <div class="step_num">
            <div class="stepNum_c">
                <span class="current">
	        			<label>输入账号</label>
	        			<i>1</i>
	        		</span>
                <span>
	        			<label>验证身份</label>
	        			<i>2</i>
	        		</span>
                <span>
	        			<label>重置密码</label>
	        			<i>3</i>
	        		</span>
                <span>
	        			<label>修改成功</label>
	        			<i>4</i>
	        		</span>
            </div>
            <p class="stepNum_bg">
                <span></span>
            </p>
        </div>
        <!-- step 1 -->
        <form class="findPwd_form" style="display:block;">
            <p class="field">
                <label>手机号：</label>
                <input type="text" placeholder="请输入注册手机号" id="one_phone" />
                <span class="error_hint"></span>
            </p>
            <p class="field">
                <label>验证码：</label>
                <input type="text" placeholder="请输入验证码" id="codetxt" />
                <img src="/user/pwdcode" alt="" id="codeimg">
                <a href="javascript:void(0);" class="refresh" id="codebtn"></a>
            </p>
            <p class=" field_btn ">
                <input type="button " value="下一步 " class="btn_next " />
            </p>
        </form>
        <!-- step 2 -->
        <form class="findPwd_form ">
            <p class="field ">
                <label>手机号：</label>
                <input type="text " disabled="true " readonly="true " value="手机号[187****5627]" id="two_phone" />
                <a href="javascript:void(0); " class="gain_code " onclick="sendPhoneCode()">获取验证码</a>
            </p>
            <p class="field ">
                <label>验证码：</label>
                <input type="text " placeholder="请输入短信验证码 " id="two_code" />
                <span class="error_hint "></span>
            </p>
            <p class="field_btn ">
                <input type="button " value="下一步 " class="btn_next " />
            </p>
        </form>
        <!-- step 3 -->
        <form class="findPwd_form ">
            <p class="field ">
                <label>新密码：</label>
                <input type="password " placeholder="请输入新密码 " id="three_pwd1" />
                <span class="hint_tline ">密码长度8-20位，建议使用字母、数字与标点的组合来提高帐号安全度</span>
            </p>
            <p class="field ">
                <label>确认新密码：</label>
                <input type="password " placeholder="请再次确认新密码 " id="three_pwd2" />
            </p>
            <p class="field_btn ">
                <input type="button " value="下一步 " class="btn_next" />
            </p>
        </form>
        <!-- step 4 -->
        <div class="modify_success ">
            <i class="ico_true "></i>
            <span>恭喜你密码修改成功</span>
        </div>
    </div>
    <script src="/js/jquery-1.10.2.min.js "></script>
    <script>
        function stepShow(index, ind) {
            var pwdForm = $('.findPwd_form');
            pwdForm.hide();
            pwdForm.eq(index).show();
            $('.stepNum_bg span').css({
                width: ind + '%'
            })
            $('.stepNum_c').find('span').eq(index).addClass('current').prev().removeClass('current').addClass('already');

            console.log(index, ind);
        }

        function stepone(index) {
            var ind = 20 * (index - (-1));
            $.ajax({
                url: "/forget/pwd",
                data: {
                    "step": 1,
                    phone: $('#one_phone').val(),
                    "code": $('#codetxt').val(),
                },
                type: "post",
                dataType: "json",
                success: function(data) {
                    if (data.code == "200") {
                        stepShow(index, ind)
                            //手机号[187****5627]
                        var phone = $('#one_phone').val();
                        var parray = phone.split("");
                        parray[3] = parray[4] = parray[5] = parray[6] = "*"
                        $('#two_phone').val("手机号[" + parray.join("") + "]");
                    } else {
                        alert(data.msg);
                    }
                }
            });
        }

        function sendPhoneCode() {
            $.ajax({
                url: "/forget/code",
                dataType: "json",
                success: function(data) {
                    if (data.code == "200") {
                        alert("获取验证码成功");
                    } else {
                        alert(data.msg);
                    }
                }
            });
        }

        function steptwo(index) {
            var ind = 20 * (index - (-1));
            $.ajax({
                url: "/forget/pwd",
                data: {
                    "step": 2,
                    "code": $('#two_code').val(),
                },
                type: "post",
                dataType: "json",
                success: function(data) {
                    if (data.code == "200") {
                        stepShow(index, ind)
                    } else {
                        alert(data.msg);
                    }
                }
            });
        }

        function stepthree(index) {
            var ind = 20 * (index - (-1));
            $.ajax({
                url: "/forget/pwd",
                data: {
                    "step": 3,
                    "pwd1": $('#three_pwd1').val(),
                    "pwd2": $('#three_pwd2').val(),
                },
                type: "post",
                dataType: "json",
                success: function(data) {
                    if (data.code == "200") {
                        ind = 100;
                        stepShow(index, ind)
                        $('.modify_success').show()
                    } else {
                        alert(data.msg);
                    }
                }
            });
        }

        $(function() {
            $('.btn_next').on('click', function() {
                var inx = $('.btn_next').index($(this)) - (-1);
                var ind = 20;
                if (inx == 1) {
                    stepone(inx);
                }
                if (inx == 2) {
                    steptwo(inx);
                }
                if (inx == 3) {
                    stepthree(inx);
                }

            });
            $('#codebtn').click(function() {
                var src = $('#codeimg').attr('src')
                src += "?t=" + (new Date()).getTime();
                $('#codeimg').attr('src', src);
            })
        })
    </script>
</body>

</html>
{{end}}